<!DOCTYPE html>
<html>
<head><title>Major Task</title></head>
<body>
  <p><a href="{% url 'tasks' %}">‚Üê Back to Major Tasks</a></p>

  <h1>{{ major_task.title }}</h1>
  <p>{{ major_task.description|linebreaksbr }}</p>
  <p>Status: {% if major_task.is_completed %}Completed{% else %}Open{% endif %}</p>

  <h3>Edit Major Task</h3>
  <form method="post" action="{% url 'task_update' major_task.user_task_id %}">
    {% csrf_token %}
    <div><label>Title <input type="text" name="title" value="{{ major_task.title }}"/></label></div>
    <div><label>Description <textarea name="description">{{ major_task.description }}</textarea></label></div>
    <div><label><input type="checkbox" name="is_completed" {% if major_task.is_completed %}checked{% endif %}/> Completed</label></div>
    <button type="submit">Save</button>
  </form>

  <hr/>
  <h2>Subtasks</h2>
  <form method="post" action="{% url 'subtask_create' major_task.user_task_id %}">
    {% csrf_token %}
    <div><label>Title <input type="text" name="title"/></label></div>
    <div><label>Description <textarea name="description"></textarea></label></div>
    <button type="submit">Add Subtask</button>
  </form>

  <ul>
    {% for st in subtasks %}
    <li>
      <strong>{{ st.title }}</strong>
      {% if st.is_completed %}<em>(completed)</em>{% endif %}
      <p>{{ st.description|linebreaksbr }}</p>
      
      <form method="post" action="{% url 'subtask_delete' major_task.user_task_id st.pk %}" style="display:inline">
        {% csrf_token %}
        <button type="submit">Delete</button>
      </form>
      
      <form method="post" action="{% url 'subtask_update' major_task.user_task_id st.pk %}" style="display:inline">
        {% csrf_token %}
        <input type="hidden" name="title" value="{{ st.title }}"/>
        <input type="hidden" name="description" value="{{ st.description }}"/>
        <input type="hidden" name="is_completed" value="{% if not st.is_completed %}on{% endif %}"/>
        <button type="submit">{% if st.is_completed %}Mark Open{% else %}Mark Done{% endif %}</button>
      </form>
      
      <details>
        <summary>Edit</summary>
        <form method="post" action="{% url 'subtask_update' major_task.user_task_id st.pk %}">
          {% csrf_token %}
          <div><label>Title <input type="text" name="title" value="{{ st.title }}"/></label></div>
          <div><label>Description <textarea name="description">{{ st.description }}</textarea></label></div>
          <input type="hidden" name="is_completed" value="{% if st.is_completed %}on{% endif %}"/>
          <button type="submit">Save</button>
        </form>
      </details>
    </li>
    {% empty %}
      <li>No subtasks yet.</li>
    {% endfor %}
  </ul>
</body>
</html>